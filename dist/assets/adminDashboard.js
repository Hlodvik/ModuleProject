import{d as e,s as t,a as n}from"./main-chunk.js";import{d as i,b as r,r as a,i as o,j as s,s as c,o as l,q as u,c as m,w as d,g as f,u as h}from"./firebase-chunk.js";import"https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,w(i.key),i)}}function p(e,t,n){return(t=w(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},v.apply(this,arguments)}function w(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var B,E,x,C,j,I,L,U,O={exports:{}};B=O,"undefined"!=typeof window&&(E=window,x=E.HTMLCanvasElement&&E.HTMLCanvasElement.prototype,C=E.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),j=C&&E.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),I=E.BlobBuilder||E.WebKitBlobBuilder||E.MozBlobBuilder||E.MSBlobBuilder,L=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,U=(C||I)&&E.atob&&E.ArrayBuffer&&E.Uint8Array&&function(e){var t,n,i,r,a,o,s,c,l;if(!(t=e.match(L)))throw new Error("invalid data URI");for(n=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),i=!!t[4],r=e.slice(t[0].length),a=i?atob(r):decodeURIComponent(r),o=new ArrayBuffer(a.length),s=new Uint8Array(o),c=0;c<a.length;c+=1)s[c]=a.charCodeAt(c);return C?new Blob([j?s:o],{type:n}):((l=new I).append(o),l.getBlob(n))},E.HTMLCanvasElement&&!x.toBlob&&(x.mozGetAsFile?x.toBlob=function(e,t,n){var i=this;setTimeout((function(){n&&x.toDataURL&&U?e(U(i.toDataURL(t,n))):e(i.mozGetAsFile("blob",t))}))}:x.toDataURL&&U&&(x.msToBlob?x.toBlob=function(e,t,n){var i=this;setTimeout((function(){(t&&"image/png"!==t||n)&&x.toDataURL&&U?e(U(i.toDataURL(t,n))):e(i.msToBlob(t))}))}:x.toBlob=function(e,t,n){var i=this;setTimeout((function(){e(U(i.toDataURL(t,n)))}))})),B.exports?B.exports=U:E.dataURLtoBlob=U);var A=O.exports,P={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},T="undefined"!=typeof window&&void 0!==window.document?window:{},k=function(e){return e>0&&e<1/0},M=Array.prototype.slice;function R(e){return Array.from?Array.from(e):M.call(e)}var D=/^image\/.+$/;function F(e){return D.test(e)}var H=String.fromCharCode;var S=T.btoa;function $(e,t){for(var n=[],i=new Uint8Array(e);i.length>0;)n.push(H.apply(null,R(i.subarray(0,8192)))),i=i.subarray(8192);return"data:".concat(t,";base64,").concat(S(n.join("")))}function z(e){var t,n=new DataView(e);try{var i,r,a;if(255===n.getUint8(0)&&216===n.getUint8(1))for(var o=n.byteLength,s=2;s+1<o;){if(255===n.getUint8(s)&&225===n.getUint8(s+1)){r=s;break}s+=1}if(r){var c=r+10;if("Exif"===function(e,t,n){var i,r="";for(n+=t,i=t;i<n;i+=1)r+=H(e.getUint8(i));return r}(n,r+4,4)){var l=n.getUint16(c);if(((i=18761===l)||19789===l)&&42===n.getUint16(c+2,i)){var u=n.getUint32(c+4,i);u>=8&&(a=c+u)}}}if(a){var m,d,f=n.getUint16(a,i);for(d=0;d<f;d+=1)if(m=a+12*d+2,274===n.getUint16(m,i)){m+=8,t=n.getUint16(m,i),n.setUint16(m,1,i);break}}}catch(h){t=1}return t}var W=/\.\d*(?:0|9){12}\d*$/;function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return W.test(e)?Math.round(e*t)/t:e}function q(e){var t=e.aspectRatio,n=e.height,i=e.width,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",a=k(i),o=k(n);if(a&&o){var s=n*t;("contain"===r||"none"===r)&&s>i||"cover"===r&&s<i?n=i/t:i=n*t}else a?n=i/t:o&&(i=n*t);return{width:i,height:n}}var N=T.ArrayBuffer,Y=T.FileReader,G=T.URL||T.webkitURL,K=/\.\w+$/,X=T.Compressor,V=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.file=t,this.exif=[],this.image=new Image,this.options=g(g({},P),n),this.aborted=!1,this.result=null,this.init()}var t,n,i;return t=e,i=[{key:"noConflict",value:function(){return window.Compressor=X,e}},{key:"setDefaults",value:function(e){v(P,e)}}],(n=[{key:"init",value:function(){var e=this,t=this.file,n=this.options;if(i=t,"undefined"!=typeof Blob&&(i instanceof Blob||"[object Blob]"===Object.prototype.toString.call(i))){var i,r=t.type;if(F(r))if(G&&Y){N||(n.checkOrientation=!1,n.retainExif=!1);var a="image/jpeg"===r,o=a&&n.checkOrientation,s=a&&n.retainExif;if(!G||o||s){var c=new Y;this.reader=c,c.onload=function(n){var i=n.target.result,a={},c=1;o&&(c=z(i))>1&&v(a,function(e){var t=0,n=1,i=1;switch(e){case 2:n=-1;break;case 3:t=-180;break;case 4:i=-1;break;case 5:t=90,i=-1;break;case 6:t=90;break;case 7:t=90,n=-1;break;case 8:t=-90}return{rotate:t,scaleX:n,scaleY:i}}(c)),s&&(e.exif=function(e){for(var t=R(new Uint8Array(e)),n=t.length,i=[],r=0;r+3<n;){var a=t[r],o=t[r+1];if(255===a&&218===o)break;if(255===a&&216===o)r+=2;else{var s=r+(256*t[r+2]+t[r+3])+2,c=t.slice(r,s);i.push(c),r=s}}return i.reduce((function(e,t){return 255===t[0]&&225===t[1]?e.concat(t):e}),[])}(i)),a.url=o||s?!G||c>1?$(i,r):G.createObjectURL(t):i,e.load(a)},c.onabort=function(){e.fail(new Error("Aborted to read the image with FileReader."))},c.onerror=function(){e.fail(new Error("Failed to read the image with FileReader."))},c.onloadend=function(){e.reader=null},o||s?c.readAsArrayBuffer(t):c.readAsDataURL(t)}else this.load({url:G.createObjectURL(t)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(e){var t=this,n=this.file,i=this.image;i.onload=function(){t.draw(g(g({},e),{},{naturalWidth:i.naturalWidth,naturalHeight:i.naturalHeight}))},i.onabort=function(){t.fail(new Error("Aborted to load the image."))},i.onerror=function(){t.fail(new Error("Failed to load the image."))},T.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(T.navigator.userAgent)&&(i.crossOrigin="anonymous"),i.alt=n.name,i.src=e.url}},{key:"draw",value:function(e){var t=this,n=e.naturalWidth,i=e.naturalHeight,r=e.rotate,a=void 0===r?0:r,o=e.scaleX,s=void 0===o?1:o,c=e.scaleY,l=void 0===c?1:c,u=this.file,m=this.image,d=this.options,f=document.createElement("canvas"),h=f.getContext("2d"),y=Math.abs(a)%180==90,g=("contain"===d.resize||"cover"===d.resize)&&k(d.width)&&k(d.height),b=Math.max(d.maxWidth,0)||1/0,p=Math.max(d.maxHeight,0)||1/0,v=Math.max(d.minWidth,0)||0,w=Math.max(d.minHeight,0)||0,B=n/i,E=d.width,x=d.height;if(y){var C=[p,b];b=C[0],p=C[1];var j=[w,v];v=j[0],w=j[1];var I=[x,E];E=I[0],x=I[1]}g&&(B=E/x);var L=q({aspectRatio:B,width:b,height:p},"contain");b=L.width,p=L.height;var U=q({aspectRatio:B,width:v,height:w},"cover");if(v=U.width,w=U.height,g){var O=q({aspectRatio:B,width:E,height:x},d.resize);E=O.width,x=O.height}else{var P=q({aspectRatio:B,width:E,height:x}),T=P.width;E=void 0===T?n:T;var M=P.height;x=void 0===M?i:M}var D=-(E=Math.floor(_(Math.min(Math.max(E,v),b))))/2,H=-(x=Math.floor(_(Math.min(Math.max(x,w),p))))/2,S=E,z=x,W=[];if(g){var N,G,K,X,V=q({aspectRatio:B,width:n,height:i},{contain:"cover",cover:"contain"}[d.resize]);K=V.width,X=V.height,N=(n-K)/2,G=(i-X)/2,W.push(N,G,K,X)}if(W.push(D,H,S,z),y){var Z=[x,E];E=Z[0],x=Z[1]}f.width=E,f.height=x,F(d.mimeType)||(d.mimeType=u.type);var J="transparent";u.size>d.convertSize&&d.convertTypes.indexOf(d.mimeType)>=0&&(d.mimeType="image/jpeg");var Q="image/jpeg"===d.mimeType;if(Q&&(J="#fff"),h.fillStyle=J,h.fillRect(0,0,E,x),d.beforeDraw&&d.beforeDraw.call(this,h,f),!this.aborted&&(h.save(),h.translate(E/2,x/2),h.rotate(a*Math.PI/180),h.scale(s,l),h.drawImage.apply(h,[m].concat(W)),h.restore(),d.drew&&d.drew.call(this,h,f),!this.aborted)){var ee=function(e){if(!t.aborted){var r=function(e){return t.done({naturalWidth:n,naturalHeight:i,result:e})};if(e&&Q&&d.retainExif&&t.exif&&t.exif.length>0){var a=function(e){return r(A($(function(e,t){var n=R(new Uint8Array(e));if(255!==n[2]||224!==n[3])return e;var i=256*n[4]+n[5],r=[255,216].concat(t,n.slice(4+i));return new Uint8Array(r)}(e,t.exif),d.mimeType)))};if(e.arrayBuffer)e.arrayBuffer().then(a).catch((function(){t.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))}));else{var o=new Y;t.reader=o,o.onload=function(e){var t=e.target;a(t.result)},o.onabort=function(){t.fail(new Error("Aborted to read the compressed image with FileReader."))},o.onerror=function(){t.fail(new Error("Failed to read the compressed image with FileReader."))},o.onloadend=function(){t.reader=null},o.readAsArrayBuffer(e)}}else r(e)}};f.toBlob?f.toBlob(ee,d.mimeType,d.quality):ee(A(f.toDataURL(d.mimeType,d.quality)))}}},{key:"done",value:function(e){var t,n,i=e.naturalWidth,r=e.naturalHeight,a=e.result,o=this.file,s=this.image,c=this.options;if(G&&0===s.src.indexOf("blob:")&&G.revokeObjectURL(s.src),a)if(c.strict&&!c.retainExif&&a.size>o.size&&c.mimeType===o.type&&!(c.width>i||c.height>r||c.minWidth>i||c.minHeight>r||c.maxWidth<i||c.maxHeight<r))a=o;else{var l=new Date;a.lastModified=l.getTime(),a.lastModifiedDate=l,a.name=o.name,a.name&&a.type!==o.type&&(a.name=a.name.replace(K,(t=a.type,"jpeg"===(n=F(t)?t.substr(6):"")&&(n="jpg"),".".concat(n))))}else a=o;this.result=a,c.success&&c.success.call(this,a)}},{key:"fail",value:function(e){var t=this.options;if(!t.error)throw e;t.error.call(this,e)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}])&&b(t.prototype,n),i&&b(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();document.addEventListener("DOMContentLoaded",(()=>{const l=document.getElementById("createCommunityForm"),u=document.getElementById("createCommunityBtn"),m=document.getElementById("communityPicInput"),d=document.getElementById("communityBannerInput");l&&u&&u.addEventListener("click",(async f=>{f.preventDefault();const h=n.currentUser;if(!h)return void alert("You must be logged in to create a community.");const y=document.getElementById("communityName").value.trim(),g=document.getElementById("subdomain").value.trim().toLowerCase(),b=document.getElementById("communityBio").value.trim();if(y&&g&&b)if(/^[a-zA-Z0-9_-]+$/.test(g))if(g.length>50)alert("Subdomain must be 50 characters or fewer.");else if(await async function(t){const n=i(e,"communities",t);return!(await r(n)).exists()}(g))try{u.disabled=!0,u.textContent="Creating...";const n=await async function(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n,a=!1;for(;!a;){n=Array.from({length:3},(()=>t[Math.floor(62*Math.random())])).join("");const o=i(e,"communities",n);a=!(await r(o)).exists()}return n}();let f="",p="";m.files.length>0&&(f=await async function(e,n){return new Promise(((i,r)=>{new V(e,{quality:.6,maxWidth:500,maxHeight:500,success(e){const c=a(t,n);o(c,e).then((async e=>{const t=await s(e.ref);i(t)})).catch(r)},error(e){r(e)}})}))}(m.files[0],`community_pics/${g}_profile.jpg`)),d.files.length>0&&(p=await async function(e,n){return new Promise(((i,r)=>{const c=a(t,n);o(c,e).then((async e=>{const t=await s(e.ref);i(t)})).catch(r)}))}(d.files[0],`community_pics/${g}_banner.jpg`));const v={name:y,subdomain:g,bio:b,createdBy:h.uid,admins:[h.uid],members:[h.uid],communityPostID:n,communityPic:f,banner:p};await c(i(e,"communities",g),v),await async function(t,n){try{await c(i(e,"searchIndex",t),{name:n.toLowerCase(),type:"community",refId:t})}catch(r){console.error("Error adding community to index:",r)}}(g,y),alert("Community created successfully."),l.reset(),bootstrap.Modal.getInstance(document.getElementById("createCommunityModal")).hide()}catch(p){console.error("Error creating community:",p),alert("Failed to create community. Please try again.")}finally{u.disabled=!1,u.textContent="Create Community"}else alert("This subdomain is already taken. Please choose another.");else alert("Subdomain can only contain letters, numbers, underscores, and hyphens.");else alert("Please fill out all required fields.")}))}));let Z=null;async function J(t){if(!t)return void te("No user ID provided.","danger");const n=document.querySelector("#communityList ul");if(n){n.innerHTML="";try{const i=u(m(e,"communities"),d("admins","array-contains",t)),r=await f(i);if(r.empty)return void(n.innerHTML='<li class="list-group-item bg-dark text-white text-center">No communities found.</li>');r.forEach((e=>{const t=e.data(),i=document.createElement("li");i.classList.add("list-group-item","bg-dark","text-white","d-flex","justify-content-between","align-items-center"),i.innerHTML=`\n                <span>${t.name} (${t.subdomain})</span>\n                <button class="btn btn-sm btn-outline-light edit-community" data-id="${e.id}">Edit</button>\n            `,n.appendChild(i)})),document.querySelectorAll(".edit-community").forEach((e=>{e.removeEventListener("click",Q),e.addEventListener("click",(e=>{const t=e.target.getAttribute("data-id");t&&Q(t)}))}))}catch(i){te("Error loading communities.","danger"),console.error(i)}}}async function Q(n){if(n){Z=n;try{const o=i(e,"communities",n),c=await r(o);if(!c.exists())return;const l=c.data();document.getElementById("editCommunityName").value=l.name||"",document.getElementById("editSubdomain").value=l.subdomain||"",document.getElementById("editCommunityBio").value=l.bio||"",async function(e){const n=document.getElementById("editCommunityPicPreview"),i=document.getElementById("editCommunityBannerPreview");if(n&&i){try{const i=a(t,`community_pics/${e}_profile.jpg`),r=(a(t,`community_pics/${e}_banner.jpg`),await s(i));n.src=r,localStorage.setItem(`communityPic_${e}`,r)}catch{console.warn("Community profile picture not found.")}try{const t=await s(communityBannerRef);i.src=t,localStorage.setItem(`communityBanner_${e}`,t)}catch{console.warn("Community banner not found.")}}else te("Image preview elements not found.","danger")}(l.subdomain),document.getElementById("editCommunityFormContainer").classList.remove("d-none"),document.getElementById("communityList").classList.add("d-none")}catch(o){te("Error loading community data for editing.","danger"),console.error(o)}}else te("No community ID provided.","danger")}async function ee(e,n){return new Promise(((i,r)=>{new V(e,{quality:.7,maxWidth:500,maxHeight:500,success(e){const c=a(t,n),l=new FileReader;l.onload=async function(t){const n=new Blob([e],{type:e.type});try{await o(c,n);const e=await s(c);i(e)}catch(a){r(a)}},l.onerror=r,l.readAsArrayBuffer(e)},error(e){r(e)}})}))}function te(e,t="info"){const n=document.getElementById("toastContainer"),i=document.createElement("div");i.className=`toast align-items-center text-bg-${t} border-0 show`,i.role="alert",i.innerHTML=`\n        <div class="d-flex">\n            <div class="toast-body">${e}</div>\n        </div>\n    `,n.appendChild(i),setTimeout((()=>i.remove()),3e3)}document.addEventListener("DOMContentLoaded",(()=>{l(n,(e=>{e?J(e.uid):te("User is not authenticated.","danger")}))})),document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("editCommunityForm"),a=document.getElementById("editCommunityPicInput"),o=document.getElementById("editCommunityBannerInput");t&&t.addEventListener("submit",(async s=>{if(s.preventDefault(),!Z)return;const c=i(e,"communities",Z),l={name:document.getElementById("editCommunityName").value.trim()||"",bio:document.getElementById("editCommunityBio").value.trim()||""};try{const e=await r(c);if(!e.exists())return void te("Community not found.","danger");const i=e.data().subdomain;if((null==a?void 0:a.files.length)>0){const e=await ee(a.files[0],`community_pics/${i}_profile.jpg`);l.communityPicUrl=e}if((null==o?void 0:o.files.length)>0){const e=await ee(o.files[0],`community_pics/${i}_banner.jpg`);l.bannerUrl=e}await h(c,l),te("Community updated successfully.","success"),t.reset(),document.getElementById("editCommunityFormContainer").classList.add("d-none"),document.getElementById("communityList").classList.remove("d-none"),J(n.currentUser.uid)}catch(u){te("Failed to update community. Please try again.","danger"),console.error(u)}}))}));
