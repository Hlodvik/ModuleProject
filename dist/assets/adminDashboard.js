import{a as e,d as t,C as n,s as a}from"./main-chunk.js";import{s as i,d as o,a as s,h as r,i as c,j as m}from"./firebase-chunk.js";import"https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";document.addEventListener("DOMContentLoaded",(()=>{const u=document.getElementById("createCommunityForm"),l=document.getElementById("createCommunityBtn"),d=document.getElementById("communityPicInput"),y=document.getElementById("communityBannerInput");u&&l&&l.addEventListener("click",(async f=>{f.preventDefault();const h=e.currentUser;if(!h)return void alert("You must be logged in to create a community.");const g=document.getElementById("communityName").value.trim(),w=document.getElementById("subdomain").value.trim().toLowerCase(),b=document.getElementById("communityBio").value.trim();if(g&&w&&b)if(/^[a-zA-Z0-9_-]+$/.test(w))if(w.length>50)alert("Subdomain must be 50 characters or fewer.");else if(await async function(e){const n=o(t,"communities",e);return!(await s(n)).exists()}(w))try{l.disabled=!0,l.textContent="Creating...";const e=await async function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n,a=!1;for(;!a;){n=Array.from({length:3},(()=>e[Math.floor(62*Math.random())])).join("");const i=o(t,"communities",n);a=!(await s(i)).exists()}return n}();let f="",p="";d.files.length>0&&(f=await async function(e,t){return new Promise(((i,o)=>{new n(e,{quality:.6,maxWidth:500,maxHeight:500,success(e){const n=r(a,t);c(n,e).then((async e=>{const t=await m(e.ref);i(t)})).catch(o)},error(e){o(e)}})}))}(d.files[0],`community_pics/${w}_profile.jpg`)),y.files.length>0&&(p=await async function(e,t){return new Promise(((n,i)=>{const o=r(a,t);c(o,e).then((async e=>{const t=await m(e.ref);n(t)})).catch(i)}))}(y.files[0],`community_pics/${w}_banner.jpg`));const I={name:g,subdomain:w,bio:b,createdBy:h.uid,admins:[h.uid],members:[h.uid],communityPostID:e,communityPic:f,banner:p};await i(o(t,"communities",w),I),await async function(e,n){try{await i(o(t,"searchIndex",e),{name:n.toLowerCase(),type:"community",refId:e})}catch(a){console.error("Error adding community to index:",a)}}(w,g),alert("Community created successfully."),u.reset(),bootstrap.Modal.getInstance(document.getElementById("createCommunityModal")).hide()}catch(p){console.error("Error creating community:",p),alert("Failed to create community. Please try again.")}finally{l.disabled=!1,l.textContent="Create Community"}else alert("This subdomain is already taken. Please choose another.");else alert("Subdomain can only contain letters, numbers, underscores, and hyphens.");else alert("Please fill out all required fields.")}))}));
