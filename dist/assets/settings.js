import{a as e,d as t,l as n,s as a}from"./main-chunk.js";import{o as s,d as r,b as o,k as d,u as i,E as l,l as c,m as u,n as m,c as y,q as p,w as f,g,r as E,i as v,j as w}from"./firebase-chunk.js";import"https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";async function B(){const n=e.currentUser,a=document.getElementById("displayName").value.trim();if(a)try{await d(n,{displayName:a}),await i(r(t,"users",n.uid),{displayName:a}),L("Display name updated successfully.","success")}catch(s){L("Failed to update display name: "+s.message,"error")}else L("Please enter a display name.","error")}async function I(){var t;const n=e.currentUser,a=document.getElementById("currentPassword");if(a&&a.value.trim())try{const e=l.credential(n.email,a.value.trim());await c(n,e),null==(t=document.getElementById("updateSection"))||t.classList.remove("d-none"),["newPassword","confirmNewPassword","updatePasswordBtn","newEmail","confirmNewEmail","updateEmailBtn"].forEach((e=>{const t=document.getElementById(e);t&&t.removeAttribute("disabled")})),L("Authentication successful. You can now update your email or password.","success")}catch(s){L("Authentication failed: "+s.message,"error")}else L("Incorrect password","error")}async function h(){const t=e.currentUser,n=document.getElementById("newPassword"),a=document.getElementById("confirmNewPassword");if(n&&a&&n.value.trim()&&a.value.trim())if(n.value.trim()===a.value.trim())try{await u(t,n.value.trim()),L("Password updated successfully.","success")}catch(s){L("Failed to update password: "+s.message,"error")}else L("Passwords do not match.","error");else L("Please enter a new password and confirm it.","error")}async function b(){const t=e.currentUser,n=document.getElementById("newEmail"),a=document.getElementById("confirmNewEmail");if(n&&a&&n.value.trim()&&a.value.trim())if(n.value.trim()===a.value.trim())try{await m(t,n.value.trim()),L("Email updated successfully.","success")}catch(s){L("Failed to update email: "+s.message,"error")}else L("Emails do not match.","error");else L("Please enter a new email and confirm it.","error")}function L(e,t){let n=document.getElementById("updateMessage");if(!n){n=document.createElement("p"),n.id="updateMessage",n.style.color="white";const e=document.getElementById("updateCredentialsForm");if(!e)return void console.error("updateCredentialsForm element not found.");e.appendChild(n)}n.textContent=e,n.style.color="success"===t?"lightgreen":"red"}document.addEventListener("DOMContentLoaded",(function(){s(e,(async e=>{e&&(await async function(e){const n=r(t,"users",e.uid);try{const e=await o(n);if(e.exists()){const t=e.data();document.getElementById("displayName").value=t.displayName||"",document.getElementById("username").value=t.username||"",document.getElementById("location").value=t.location||"",document.getElementById("pronouns").value=t.pronouns||"",document.getElementById("bio").value=t.bio||"",document.getElementById("linkedin").value=t.linkedin||"",document.getElementById("github").value=t.github||"",document.getElementById("instagram").value=t.instagram||"",document.getElementById("twitter").value=t.twitter||""}}catch(a){console.error("Error fetching user data:",a)}}(e),function(){const e=document.getElementById("authButton"),t=document.getElementById("updatePasswordBtn"),n=document.getElementById("updateEmailBtn"),a=document.getElementById("updateDisplayNameBtn"),s=document.getElementById("updateCredentialsForm"),r=document.getElementById("currentPassword");r&&r.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),I())}));e&&e.addEventListener("click",I);t&&t.addEventListener("click",h);n&&n.addEventListener("click",b);a&&a.addEventListener("click",B);s&&s.addEventListener("submit",(e=>e.preventDefault()))}())}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("saveBtn");e&&(e.disabled=!0,e.addEventListener("click",k)),function(){const e=document.querySelectorAll("#editProfileForm input, #editProfileForm textarea"),t=document.getElementById("saveBtn");e.forEach((e=>{e.addEventListener("input",(()=>{C[e.id]=e.value.trim(),t.disabled=!1}))}))}(),function(){const e=document.getElementById("username");if(!e)return;let n=document.getElementById("usernameMessage");n||(n=document.createElement("p"),n.id="usernameMessage",n.style.marginTop="5px",n.style.fontSize="0.9rem",e.parentNode.appendChild(n));e.addEventListener("input",(async()=>{const a=e.value.trim(),s=/^[\p{L}0-9_-]+$/u;if(a.length<3)return n.textContent="Username must be at least 3 characters.",n.style.color="red",void(P=!1);if(!s.test(a))return n.textContent="Invalid username. Use only letters, numbers, dashes (-), or underscores (_).",n.style.color="red",void(P=!1);const r=y(t,"users"),o=p(r,f("username","==",a));(await g(o)).empty?(n.textContent="Username is available.",n.style.color="green",P=!0):(n.textContent="Username is already taken.",n.style.color="red",P=!1)}))}()}));const C={};let P=!0;async function k(n){n.preventDefault();const a=document.getElementById("saveBtn"),s=document.getElementById("saveMessage");if(0===Object.keys(C).length)return void console.log("No changes detected.");if(!P)return s.textContent="Cannot save: Username is either invalid or taken.",void(s.style.color="red");const o=e.currentUser;if(o)try{a.disabled=!0,a.textContent="Saving...",await i(r(t,"users",o.uid),C),console.log("Updated fields:",C),s.textContent="Profile updated successfully!",s.style.color="green",Object.keys(C).forEach((e=>delete C[e])),a.textContent="Save Changes",a.disabled=!0}catch(d){console.error("Error updating profile:",d),s.textContent="Error saving profile. Try again.",s.style.color="red",a.textContent="Save Changes",a.disabled=!1}else console.error("No authenticated user.")}function U(){const s=document.getElementById("profileUpload"),o=document.getElementById("profileModalPic"),d=document.getElementById("confirmUpload"),l=document.getElementById("profilePreviewModal"),c=document.getElementById("uploadSpinner");if(!(s&&o&&d&&l&&c))return void console.error("One or more profile upload elements are missing.");s.addEventListener("submit",(function(e){e.preventDefault()}));let u=bootstrap.Modal.getInstance(l)||new bootstrap.Modal(l),m=null;s.addEventListener("change",(function(e){if(m=e.target.files[0],!m)return;console.log("File selected:",m);const t=new FileReader;t.onload=function(e){o.src=e.target.result},t.readAsDataURL(m),u.show()})),d.replaceWith(d.cloneNode(!0)),document.getElementById("confirmUpload").addEventListener("click",(async function(){if(!m)return;const s=e.currentUser;if(s)try{d.disabled=!0,c.classList.remove("d-none");const e=E(a,`profile_pics/${s.uid}.jpg`);await v(e,m);const o=await w(e);await i(r(t,"users",s.uid),{profilePic:o}),await n(s.uid,document.getElementById("profilePic")),document.dispatchEvent(new CustomEvent("profilePicUpdated",{detail:{newPic:o}}))}catch(o){console.error("Error updating profile picture:",o)}finally{d.disabled=!1,c.classList.add("d-none"),u.hide(),m=null}else console.error("No authenticated user.")}))}document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("profilePic");t&&(t.addEventListener("click",U),s(e,(async e=>{e&&await n(e.uid,t)})))}));
