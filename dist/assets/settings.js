import{a as e,d as t,l as n,s as a}from"./main-chunk.js";import{o as s,d as r,a as o,u as d,b as i,E as c,r as l,e as u,f as m,h as p,i as f,j as y}from"./firebase-chunk.js";import"https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";async function E(){const n=e.currentUser,a=document.getElementById("displayName").value.trim();if(a)try{await d(n,{displayName:a}),await i(r(t,"users",n.uid),{displayName:a}),B("Display name updated successfully.","success")}catch(s){B("Failed to update display name: "+s.message,"error")}else B("Please enter a display name.","error")}async function g(){var t;const n=e.currentUser,a=document.getElementById("currentPassword");if(a&&a.value.trim())try{const e=c.credential(n.email,a.value.trim());await l(n,e),null==(t=document.getElementById("updateSection"))||t.classList.remove("d-none"),["newPassword","confirmNewPassword","updatePasswordBtn","newEmail","confirmNewEmail","updateEmailBtn"].forEach((e=>{const t=document.getElementById(e);t&&t.removeAttribute("disabled")})),B("Authentication successful. You can now update your email or password.","success")}catch(s){B("Authentication failed: "+s.message,"error")}else B("Incorrect password","error")}async function w(){const t=e.currentUser,n=document.getElementById("newPassword"),a=document.getElementById("confirmNewPassword");if(n&&a&&n.value.trim()&&a.value.trim())if(n.value.trim()===a.value.trim())try{await u(t,n.value.trim()),B("Password updated successfully.","success")}catch(s){B("Failed to update password: "+s.message,"error")}else B("Passwords do not match.","error");else B("Please enter a new password and confirm it.","error")}async function v(){const t=e.currentUser,n=document.getElementById("newEmail"),a=document.getElementById("confirmNewEmail");if(n&&a&&n.value.trim()&&a.value.trim())if(n.value.trim()===a.value.trim())try{await m(t,n.value.trim()),B("Email updated successfully.","success")}catch(s){B("Failed to update email: "+s.message,"error")}else B("Emails do not match.","error");else B("Please enter a new email and confirm it.","error")}function B(e,t){let n=document.getElementById("updateMessage");if(!n){n=document.createElement("p"),n.id="updateMessage",n.style.color="white";const e=document.getElementById("updateCredentialsForm");if(!e)return void console.error("updateCredentialsForm element not found.");e.appendChild(n)}n.textContent=e,n.style.color="success"===t?"lightgreen":"red"}function I(){const s=document.getElementById("profileUpload"),o=document.getElementById("profileModalPic"),d=document.getElementById("confirmUpload"),c=document.getElementById("profilePreviewModal"),l=document.getElementById("uploadSpinner");if(!(s&&o&&d&&c&&l))return void console.error("One or more profile upload elements are missing.");s.addEventListener("submit",(function(e){e.preventDefault()}));let u=bootstrap.Modal.getInstance(c)||new bootstrap.Modal(c),m=null;s.addEventListener("change",(function(e){if(m=e.target.files[0],!m)return;console.log("File selected:",m);const t=new FileReader;t.onload=function(e){o.src=e.target.result},t.readAsDataURL(m),u.show()})),d.replaceWith(d.cloneNode(!0)),document.getElementById("confirmUpload").addEventListener("click",(async function(){if(!m)return;const s=e.currentUser;if(s)try{d.disabled=!0,l.classList.remove("d-none");const e=p(a,`profile_pics/${s.uid}.jpg`);await f(e,m);const o=await y(e);await i(r(t,"users",s.uid),{profilePic:o}),await n(s.uid,document.getElementById("profilePic")),document.dispatchEvent(new CustomEvent("profilePicUpdated",{detail:{newPic:o}}))}catch(o){console.error("Error updating profile picture:",o)}finally{d.disabled=!1,l.classList.add("d-none"),u.hide(),m=null}else console.error("No authenticated user.")}))}document.addEventListener("DOMContentLoaded",(function(){s(e,(async e=>{e&&(await async function(e){const n=r(t,"users",e.uid);try{const e=await o(n);if(e.exists()){const t=e.data();document.getElementById("displayName").value=t.displayName||"",document.getElementById("username").value=t.username||"",document.getElementById("location").value=t.location||"",document.getElementById("pronouns").value=t.pronouns||"",document.getElementById("bio").value=t.bio||"",document.getElementById("linkedin").value=t.linkedin||"",document.getElementById("github").value=t.github||"",document.getElementById("instagram").value=t.instagram||"",document.getElementById("twitter").value=t.twitter||""}}catch(a){console.error("Error fetching user data:",a)}}(e),function(){const e=document.getElementById("authButton"),t=document.getElementById("updatePasswordBtn"),n=document.getElementById("updateEmailBtn"),a=document.getElementById("updateDisplayNameBtn"),s=document.getElementById("updateCredentialsForm"),r=document.getElementById("currentPassword");r&&r.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),g())}));e&&e.addEventListener("click",g);t&&t.addEventListener("click",w);n&&n.addEventListener("click",v);a&&a.addEventListener("click",E);s&&s.addEventListener("submit",(e=>e.preventDefault()))}())}))})),document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("profilePic");t&&(t.addEventListener("click",I),s(e,(async e=>{e&&await n(e.uid,t)})))}));
